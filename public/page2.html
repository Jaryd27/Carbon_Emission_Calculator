<!DOCTYPE html> 
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>NRG - Environmental Footprint Calculator</title>
<link rel="stylesheet" href="/styles/style.css" />
<style>
  body { font-family: Arial, sans-serif; background-color: #f5f5f5; margin: 0; padding: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
  .form-container { background-color: white; padding: 30px 40px; border-radius: 15px; box-shadow: 0 0 15px rgba(0,0,0,0.1); text-align: center; width: 100%; max-width: 600px; }
  h1 { margin-bottom: 20px; font-family: 'Lora', serif; color: #77dd77; }
  form { display: flex; flex-direction: column; align-items: flex-start; width: 100%; }
  label { margin-top: 15px; margin-bottom: 5px; font-weight: bold; width: 100%; }
  input[type="text"], select { width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ccc; font-size: 1rem; }
  button { margin-top: 25px; align-self: center; padding: 10px 30px; font-size: 16px; border: none; border-radius: 5px; background-color: #007bff; color: white; cursor: pointer; transition: background-color 0.3s ease; }
  button:hover { background-color: #0056b3; }

  .logo-container {
      display: flex;
      justify-content: center;   /* centers horizontally */
      align-items: center;
      margin-bottom: 20px;       /* spacing before title */
    }

  .logo {
      width: 180px;              /* set desired size */
      height: auto;
    }  
    
</style>
</head>
<body>
<div class="form-container">

  <div class="logo-container">
      <img src="/images/NRG-LOGO.png" alt="Next Renewable Generation Logo" class="logo">
    </div>

  <h1>Please provide your details</h1>
  <form id="detailsForm">
    <label for="companyName">What is your company name? (optional)</label>
    <input type="text" id="companyName" name="companyName" placeholder="Company name" />

    <label for="industry">What industry are you in?</label>
    <select id="industry" name="industry" required disabled>
      <option value="">Loading industries...</option>
    </select>

    <label for="activities">What are your company's main activities?</label>
    <input type="text" id="activities" name="activities" placeholder="Describe main activities" required />

    <label for="intent">What is your intent for using the calculator?</label>
    <input type="text" id="intent" name="intent" placeholder="e.g., Internal reporting, carbon reduction planning..." required />

    <button type="submit">Continue</button>
  </form>
</div>

<script>
async function loadIndustries() {
  const select = document.getElementById('industry');
  select.innerHTML = '<option value="">Loading industries...</option>';
  select.disabled = true;

  try {
    const res = await fetch('/api/industries');
    if (!res.ok) throw new Error(`HTTP error ${res.status}`);

    const industries = await res.json();
    if (!Array.isArray(industries) || industries.length === 0) throw new Error('No industries found');

    select.innerHTML = '<option value="">Please Select</option>';
    industries.forEach(ind => {
      const option = document.createElement('option');
      option.value = ind.Industry;
      option.textContent = ind.Industry;
      select.appendChild(option);
    });
    select.disabled = false;
  } catch (err) {
    console.error('Failed to load industries:', err);
    select.innerHTML = '<option value="">Error loading industries</option>';
    select.disabled = true;
  }
}

window.addEventListener('DOMContentLoaded', () => {
  loadIndustries();

  const form = document.getElementById('detailsForm');
  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    const company = e.target.companyName.value.trim() || '';
    const industry = e.target.industry.value;
    const activities = e.target.activities.value.trim();
    const intent = e.target.intent.value.trim();

    if (!industry || !activities || !intent) {
      alert('Please complete all required fields.');
      return;
    }

    // Save values to sessionStorage
    sessionStorage.setItem('Company', company);
    sessionStorage.setItem('Industry', industry);
    sessionStorage.setItem('Activities', activities);
    sessionStorage.setItem('Intent', intent);

    // Append to combined data string from index.html
    let combinedData = sessionStorage.getItem('combinedData') || '';
    combinedData += `|${company}|${industry}|${activities}|${intent}`;
    sessionStorage.setItem('combinedData', combinedData);

    // Optional backend save
    try {
      await fetch('/api/client-info', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ company, industry, activities, intent })
      });
    } catch (err) {
      console.error('Error saving client info:', err);
    }

    window.location.href = '/page3.html';
  });
});
</script>
</body>
</html>
